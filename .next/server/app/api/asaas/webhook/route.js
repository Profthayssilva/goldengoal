"use strict";(()=>{var e={};e.id=3484,e.ids=[3484],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},58349:(e,a,o)=>{o.r(a),o.d(a,{headerHooks:()=>E,originalPathname:()=>k,patchFetch:()=>b,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>c,staticGenerationAsyncStorage:()=>A,staticGenerationBailout:()=>h});var r={};o.r(r),o.d(r,{POST:()=>d});var t=o(95419),n=o(69108),s=o(99678),i=o(78070),u=o(9108);async function d(e){try{let a=e.headers.get("access_token"),o=process.env.ASAAS_WEBHOOK_TOKEN;if(o||console.warn("[ASAAS] ASAAS_WEBHOOK_TOKEN n\xe3o configurado no .env"),o&&a!==o)return i.default.json({error:"Unauthorized"},{status:401});let r=await e.json(),t=r.event,n=r.payment;if(console.log("[ASAAS] Webhook recebido:",t,n?.id),!n?.id)return i.default.json({ok:!0});let s=await u.prisma.pagamento.findFirst({where:{asaasPaymentId:n.id}});if(!s)return console.warn("[ASAAS] Cobran\xe7a n\xe3o encontrada no banco:",n.id),i.default.json({ok:!0});let d=null;switch(t){case"PAYMENT_CONFIRMED":d="PAGO";break;case"PAYMENT_OVERDUE":d="ATRASADO";break;case"PAYMENT_UPDATED":d=n.status?.toUpperCase()??null;break;case"PAYMENT_DELETED":d="CANCELADO";break;case"PAYMENT_REFUNDED":d="REEMBOLSADO";break;default:return console.log("[ASAAS] Evento ignorado:",t),i.default.json({ok:!0})}return d&&await u.prisma.pagamento.update({where:{id:s.id},data:{status:d,boletoUrl:n.bankSlipUrl??s.boletoUrl,pixQrCode:n.pixQrCodeEncodedImage??s.pixQrCode,pixPayload:n.pixPayload??s.pixPayload}}),i.default.json({ok:!0})}catch(e){return console.error("[ASAAS] Erro Webhook:",e),i.default.json({error:"Webhook error"},{status:500})}}let l=new t.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/asaas/webhook/route",pathname:"/api/asaas/webhook",filename:"route",bundlePath:"app/api/asaas/webhook/route"},resolvedPagePath:"D:\\fut7\\app\\api\\asaas\\webhook\\route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:p,staticGenerationAsyncStorage:A,serverHooks:c,headerHooks:E,staticGenerationBailout:h}=l,k="/api/asaas/webhook/route";function b(){return(0,s.patchFetch)({serverHooks:c,staticGenerationAsyncStorage:A})}},9108:(e,a,o)=>{o.d(a,{Z:()=>t});let r=require("@prisma/client"),t=globalThis.prisma??new r.PrismaClient({log:["query","error","warn"]})}};var a=require("../../../../webpack-runtime.js");a.C(e);var o=e=>a(a.s=e),r=a.X(0,[1638,6206],()=>o(58349));module.exports=r})();